/*
* storeLocator v1.3 - jQuery store locator plugin
* (c) Copyright 2012, Bjorn Holine (http://www.bjornblog.com)
* Released under the MIT license
* Distance calculation function by Chris Pietschmann: http://pietschsoft.com/post/2008/02/01/Calculate-Distance-Between-Geocodes-in-C-and-JavaScript.aspx
*/

(function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"list",formID:"user-location",inputID:"address",zoomLevel:12,pinColor:"fe7569",pinTextColor:"000000",storeLimit:26,distanceAlert:60,dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",bounceMarker:true,slideMap:true,modalWindow:false,defaultLoc:false,defaultLat:"",defaultLng:"",jsonData:false,autoGeocode:false},b);
return this.each(function(){var p=a(this);if(c.modalWindow==true){p.wrap('<div id="overlay"><div id="modal-window"><div id="modal-content">');a("#modal-window").prepend('<div id="close-icon"></div>');
a("#overlay").hide();}if(c.slideMap==true){p.hide();}var o,s,t,l,g,m;var k=new Array();var q={};q.EarthRadiusInMiles=3956;q.EarthRadiusInKilometers=6367;
q.ToRadian=function(r){return r*(Math.PI/180);};q.DiffRadian=function(v,r){return q.ToRadian(r)-q.ToRadian(v);};q.CalcDistance=function(y,x,w,v,r){return r*2*Math.asin(Math.min(1,Math.sqrt((Math.pow(Math.sin((q.DiffRadian(y,w))/2),2)+Math.cos(q.ToRadian(y))*Math.cos(q.ToRadian(w))*Math.pow(Math.sin((q.DiffRadian(x,v))/2),2)))));
};function n(){geocoder=new google.maps.Geocoder();this.geocode=function(r,v){geocoder.geocode({address:r},function(y,x){if(x==google.maps.GeocoderStatus.OK){var w={};
w.latitude=y[0].geometry.location.lat();w.longitude=y[0].geometry.location.lng();v(w);}else{alert("Geocode was not successful for the following reason: "+x);
v(null);}});};}function u(){geocoder=new google.maps.Geocoder();this.geocode=function(v,r){geocoder.geocode({latLng:v},function(y,x){if(x==google.maps.GeocoderStatus.OK){if(y[0]){var w={};
w.address=y[0].formatted_address;r(w);}}else{alert("Geocode was not successful for the following reason: "+x);r(null);}});};}if(c.defaultLoc==true){var e=new u();
var f=new google.maps.LatLng(c.defaultLat,c.defaultLng);e.geocode(f,function(v){if(v!=null){var r=v.address;d(c.defaultLat,c.defaultLng,r);}else{alert("Unable to find address");
}});}if(c.autoGeocode==true){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(i,h);}}function i(v){var w=new u();var x=new google.maps.LatLng(v.coords.latitude,v.coords.longitude);
w.geocode(x,function(y){if(y!=null){var r=y.address;d(v.coords.latitude,v.coords.longitude,r);}else{alert("Unable to find address");}});}function h(r){alert("Automatic location detection failed. Please fill in your address or zip code.");
}function j(v,w){var r=Math.round(v*Math.pow(10,w))/Math.pow(10,w);return r;}a(function(){a(document).on("submit","#"+c.formID,function(w){w.preventDefault();
var x=a("#"+c.formID+" #"+c.inputID).serialize();x=x.replace("address=","");if(x==""){alert("The input box was blank.");}else{var v=new n();var r=x;v.geocode(r,function(y){if(y!=null){s=y.latitude;
t=y.longitude;d(s,t,x);}else{alert("ERROR! Unable to geocode address");}});}});});function d(r,w,v){a(function(){var x;if(c.jsonData==true){x="json";}else{x="xml";
}a.ajax({type:"GET",url:c.dataLocation,dataType:x,success:function(z){var y=0;if(c.jsonData==true){a.each(z,function(){var D=this.locname;var L=this.lat;
var M=this.lng;var N=this.address;var C=this.address2;var H=this.city;var B=this.state;var J=this.postal;var K=this.phone;var I=this.web;I=I.replace("http://","");
var G=this.hours1;var F=this.hours2;var E=this.hours3;var A=q.CalcDistance(r,w,L,M,q.EarthRadiusInMiles);k[y]=new Array(A,D,L,M,N,C,H,B,J,K,I,G,F,E);y++;
});}else{a(z).find("marker").each(function(){var D=a(this).attr("name");var L=a(this).attr("lat");var M=a(this).attr("lng");var N=a(this).attr("address");
var C=a(this).attr("address2");var H=a(this).attr("city");var B=a(this).attr("state");var J=a(this).attr("postal");var K=a(this).attr("phone");var I=a(this).attr("web");
I=I.replace("http://","");var G=a(this).attr("hours1");var F=a(this).attr("hours2");var E=a(this).attr("hours3");var A=q.CalcDistance(r,w,L,M,q.EarthRadiusInMiles);
k[y]=new Array(A,D,L,M,N,C,H,B,J,K,I,G,F,E);y++;});}k.sort(function(C,B){var A=C[0];var D=B[0];return((A<D)?-1:((A>D)?1:0));});if(k[0][0]>c.distanceAlert){alert("Unfortunately, our closest location is more than "+c.distanceAlert+" miles away.");
}a(function(){var X,P,N,L,D,S,B,T,E,K,J,I;function Q(Y){X=k[Y][0];P=k[Y][1];N=k[Y][4];L=k[Y][5];D=k[Y][6];S=k[Y][7];B=k[Y][8];T=k[Y][9];E=k[Y][10];K=k[Y][11];
J=k[Y][12];I=k[Y][13];X=j(X,2);}var M={zoom:c.zoomLevel,center:new google.maps.LatLng(r,w),mapTypeId:google.maps.MapTypeId.ROADMAP};if(c.slideMap==true){p.slideDown();
}if(c.modalWindow==true){a("#overlay").fadeIn();a(document).on("click","#close-icon",function(){a("#overlay").hide();});a(document).on("click","#overlay",function(){a("#overlay").hide();
});a(document).on("click","#modal-window",function(Y){Y.stopPropagation();});a(document).keyup(function(Y){if(Y.keyCode==27){a("#overlay").hide();}});}var V=new google.maps.Map(document.getElementById(c.mapDiv),M);
var U=new Array();var H=new google.maps.InfoWindow();if((k.length-1)<c.storeLimit-1){m=k.length-1;}else{m=c.storeLimit-1;}for(var G=0;G<=m;G++){var W=String.fromCharCode("A".charCodeAt(0)+G);
var R=new google.maps.LatLng(k[G][2],k[G][3]);l=A(R,k[G][1],k[G][4],W);U[G]=l;Q(G);C(l,P,N,L,D,S,B,T,E,K,J,I);}a("#"+c.listDiv).empty();a(U).each(function(Y,Z){var aa=String.fromCharCode("A".charCodeAt(0)+Y);
Q(Y);O(X,aa,Z,P,N,L,D,S,B,T,E,K,J,I);});function O(aa,ag,am,ad,af,ac,al,ab,ae,ao,an,ak,ai,ah){var Z;if(aa<=1){Z="mile";}else{Z="miles";}var Y=af+" "+ac+", "+al+", "+ab+" "+ae;
var aj='<a href="http://maps.google.com/maps?saddr='+v+"&daddr="+Y+'" target="_blank">Directions</a>';a("<li />").html('<div class="list-label">'+ag+'</div><div class="list-details"><div class="list-content"><div class="loc-name">'+P+'</div> <div class="loc-addr">'+N+'</div> <div class="loc-addr2">'+L+'</div> <div class="loc-addr3">'+D+", "+S+" "+B+'</div> <div class="loc-phone">'+T+'</div> <div class="loc-web"><a href="http://'+E+'" target="_blank">'+E+'</a></div><div class="loc-dist">'+aa+" "+Z+'</div><div class="loc-directions">'+aj+"</div></div></div>").click(function(){V.panTo(am.getPosition());
var ap="left";if(c.bounceMarker==true){am.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){am.setAnimation(null);C(am,ad,af,ac,al,ab,ae,ao,an,ak,ai,ah,ap);
},700);}else{C(am,ad,af,ac,al,ab,ae,ao,an,ak,ai,ah,ap);}}).appendTo("#"+c.listDiv);}a("#"+c.listDiv+" li:even .list-details").css("background","#"+c.listColor1);
a("#"+c.listDiv+" li:odd .list-details").css("background","#"+c.listColor2);function A(Y,ab,aa,ae){var ad=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld="+ae+"|"+c.pinColor+"|"+c.pinTextColor,new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));
var ac=new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",new google.maps.Size(40,37),new google.maps.Point(0,0),new google.maps.Point(12,35));
var Z=new google.maps.Marker({position:Y,map:V,icon:ad,shadow:ac,draggable:false});return Z;}function F(Y){var Z;if(Y!=""){Z="<div>"+Y+"</div>";}else{Z="";
}return Z;}function C(ai,aa,ab,Z,ag,Y,ac,ak,aj,af,ae,ad,al){var ah='<div class="loc-name">'+aa+"</div>"+F(ab)+F(Z)+ag+", "+Y+" "+ac+F(af)+F(ae)+F(ad)+F(ak)+'<div><a href="http://'+aj+'" target="_blank">'+aj+"</a></div>";
if(al=="left"){H.setContent(ah);H.open(ai.get(c.mapDiv),ai);}else{google.maps.event.addListener(ai,"click",function(){H.setContent(ah);H.open(ai.get(c.mapDiv),ai);
});}}});}});});}});};})(jQuery);